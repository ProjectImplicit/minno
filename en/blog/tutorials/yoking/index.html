<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.74.3" /><META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Yoking participants (seeded randomization) | </title><meta property="og:title" content="Yoking participants (seeded randomization)" />
<meta property="og:description" content="Most of the time we want randomization to be fully random. In some cases it is usefull to yoke pairs of participants together so that they each recieve the same randomization. MinnoJS does not (yet) support this out of the box, but it is fairly easy to implement using a pseudorandom number generator (PRNG). The PRNG allows us to create a series of random numbers depending on an initial seed. This means that if we can pass a seed to the player (via query string), we can generate the same randomization for a pair of participants." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/en/blog/tutorials/yoking/" />

<meta itemprop="name" content="Yoking participants (seeded randomization)">
<meta itemprop="description" content="Most of the time we want randomization to be fully random. In some cases it is usefull to yoke pairs of participants together so that they each recieve the same randomization. MinnoJS does not (yet) support this out of the box, but it is fairly easy to implement using a pseudorandom number generator (PRNG). The PRNG allows us to create a series of random numbers depending on an initial seed. This means that if we can pass a seed to the player (via query string), we can generate the same randomization for a pair of participants.">

<meta itemprop="wordCount" content="582">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Yoking participants (seeded randomization)"/>
<meta name="twitter:description" content="Most of the time we want randomization to be fully random. In some cases it is usefull to yoke pairs of participants together so that they each recieve the same randomization. MinnoJS does not (yet) support this out of the box, but it is fairly easy to implement using a pseudorandom number generator (PRNG). The PRNG allows us to create a series of random numbers depending on an initial seed. This means that if we can pass a seed to the player (via query string), we can generate the same randomization for a pair of participants."/>







<link rel="preload" href="/scss/main.min.2b3f0c56cf34795796f776325f0851d09b271972227cc6cb952d02ee2a9955bd.css" as="style">
<link href="/scss/main.min.2b3f0c56cf34795796f776325f0851d09b271972227cc6cb952d02ee2a9955bd.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>




  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold"></span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link" href="/en/about/" ><span>About</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link" href="/en/docs/" ><span>Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link active" href="/en/blog/" ><span class="active">Blog</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
</div>
</nav>

    </header>
    <div class="container-fluid td-default td-outer">
      <main role="main" class="td-main">
        

<p>Most of the time we want randomization to be fully random.
In some cases it is usefull to yoke pairs of participants together so that they each recieve the same randomization.
MinnoJS does not (yet) support this out of the box, but it is fairly easy to implement using a <a href="https://en.wikipedia.org/wiki/Pseudorandom_number_generator">pseudorandom number generator (PRNG)</a>.
The PRNG allows us to create a series of random numbers depending on an initial seed.
This means that if we can pass a seed to the player (via <a href="https://en.wikipedia.org/wiki/Query_string">query string</a>), we can generate the same randomization for a pair of participants.</p>
<p>Therefore we need to:</p>
<ol>
<li>Put together a pseudorandom number generator</li>
<li>Seed it from the url</li>
<li>Shuffle the sequence</li>
</ol>
<p>There are many PRNGs to choose from, for this blog we will use sfc32 which is both one of the fastest and highest quality PRNGs implemented in Javascript.
PRNGs typically need a separate algorithm to generate a seed with sufficient entropy.
This is best achieved by a hashing algorithm, in our case xmur3.
(The implementations for both come from <a href="https://stackoverflow.com/a/47593316/1400366">here</a>).</p>
<p>The following function returns a seeded random number generator that returns a random number between zero and one.
This behaves the same as the equivalent native Javacript function <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random">Math.random</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">generatePRNG</span>(<span style="color:#a6e22e">seedStr</span>){
    <span style="color:#75715e">// Create xmur3 state:
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">seed</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">xmur3</span>(<span style="color:#a6e22e">seedStr</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&#39;</span>); <span style="color:#75715e">// make sure that seed is string
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// Output four 32-bit hashes to provide the seed for sfc32.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span>  <span style="color:#a6e22e">sfc32</span>(<span style="color:#a6e22e">seed</span>(), <span style="color:#a6e22e">seed</span>(), <span style="color:#a6e22e">seed</span>(), <span style="color:#a6e22e">seed</span>());

    <span style="color:#75715e">// seed generator
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">xmur3</span>(<span style="color:#a6e22e">str</span>) {
        <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">h</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1779033703</span> <span style="color:#f92672">^</span> <span style="color:#a6e22e">str</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">str</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>)
            <span style="color:#a6e22e">h</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">imul</span>(<span style="color:#a6e22e">h</span> <span style="color:#f92672">^</span> <span style="color:#a6e22e">str</span>.<span style="color:#a6e22e">charCodeAt</span>(<span style="color:#a6e22e">i</span>), <span style="color:#ae81ff">3432918353</span>),
            <span style="color:#a6e22e">h</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">h</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">13</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">h</span> <span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">19</span>;
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span>() {
            <span style="color:#a6e22e">h</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">imul</span>(<span style="color:#a6e22e">h</span> <span style="color:#f92672">^</span> <span style="color:#a6e22e">h</span> <span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">2246822507</span>);
            <span style="color:#a6e22e">h</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">imul</span>(<span style="color:#a6e22e">h</span> <span style="color:#f92672">^</span> <span style="color:#a6e22e">h</span> <span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">3266489909</span>);
            <span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">^=</span> <span style="color:#a6e22e">h</span> <span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">0</span>;
        };
    }

    <span style="color:#75715e">// PRNG
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sfc32</span>(<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">d</span>) {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span>() {
            <span style="color:#a6e22e">a</span> <span style="color:#f92672">&gt;&gt;&gt;=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">b</span> <span style="color:#f92672">&gt;&gt;&gt;=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">c</span> <span style="color:#f92672">&gt;&gt;&gt;=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">d</span> <span style="color:#f92672">&gt;&gt;&gt;=</span> <span style="color:#ae81ff">0</span>; 
            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">a</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">b</span>) <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>;
            <span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">b</span> <span style="color:#f92672">^</span> <span style="color:#a6e22e">b</span> <span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">9</span>;
            <span style="color:#a6e22e">b</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">+</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>;
            <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">21</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">11</span>);
            <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>;
            <span style="color:#a6e22e">t</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>;
            <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>;
            <span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">t</span> <span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">4294967296</span>;
        }
    }
}
</code></pre></div><p>The next step is seeding the PRNG.
We assume that a url parameter has been passed to the player (something like <em>mydomain.com/player?yoke=213</em>).
MinnoJS v0.3 has a utility to help us get url parameters, and so we have a one liner here.
If you are using an older version you can get the parameter yourself
(<a href="https://stackoverflow.com/questions/979975/how-to-get-the-value-from-the-get-parameters">see here</a>).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rand</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">generatePRNG</span>(<span style="color:#a6e22e">global</span>.<span style="color:#a6e22e">$url</span>.<span style="color:#a6e22e">yoke</span>));
</code></pre></div><p>We now need a method to randomize the order of an array of objects.
The obvious candidate is the <a href="https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle">fisher-yates shuffle</a>.
Following is a Javascript implementation (from <a href="https://stackoverflow.com/a/2450976/1400366">here</a>).
Note that instead of using <code>Math.random</code> we use <code>rand()</code> which is a call to our PRNG.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">shuffle</span>(<span style="color:#a6e22e">array</span>) {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">currentIndex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">array</span>.<span style="color:#a6e22e">length</span>, <span style="color:#a6e22e">temporaryValue</span>, <span style="color:#a6e22e">randomIndex</span>;

    <span style="color:#75715e">// While there remain elements to shuffle...
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">0</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">currentIndex</span>) {

        <span style="color:#75715e">// Pick a remaining element...
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">randomIndex</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(<span style="color:#a6e22e">rand</span>() <span style="color:#f92672">*</span> <span style="color:#a6e22e">currentIndex</span>);
        <span style="color:#a6e22e">currentIndex</span> <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>;

        <span style="color:#75715e">// And swap it with the current element.
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">temporaryValue</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">array</span>[<span style="color:#a6e22e">currentIndex</span>];
        <span style="color:#a6e22e">array</span>[<span style="color:#a6e22e">currentIndex</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">array</span>[<span style="color:#a6e22e">randomIndex</span>];
        <span style="color:#a6e22e">array</span>[<span style="color:#a6e22e">randomIndex</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">temporaryValue</span>;
    }

    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">array</span>;
}
</code></pre></div><p>And now we have the tools to randomize to our hearts content.
The following is a contrieved example, your use case is probably more involved.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sequence</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">shuffle</span>([
    {<span style="color:#a6e22e">inherit</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;task1&#39;</span>},
    {<span style="color:#a6e22e">inherit</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;task2&#39;</span>},
    {<span style="color:#a6e22e">inherit</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;task3&#39;</span>},
    {<span style="color:#a6e22e">inherit</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;task4&#39;</span>}
]);
</code></pre></div>


      </main>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        
        
	
		<p class="mt-2"><a href="/en/about/">About MinnoJS</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>











<script src="/js/main.min.b201a3c9217360dbc0727dd320ea5f0bfc3f9128a4baa02246fb92034f9442a3.js" integrity="sha256-sgGjySFzYNvAcn3TIOpfC/w/kSikuqAiRvuSA0&#43;UQqM=" crossorigin="anonymous"></script>




  </body>
</html>
<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.74.3" /><META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Creating a custom logger | </title><meta property="og:title" content="Creating a custom logger" />
<meta property="og:description" content="MinnoJS automatically sends data from questionnaires (miQuest) and about tasks (which task was visited). It also sends data from reaction-time tasks (those programmed in miTime), about all the trials that triggered the ‘log’ action. But there is more. You can create custom loggers for integration with other systems. In this post we will create a logger that takes data from a minno-time task and saves it as a JSON string into an input element." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/en/blog/tutorials/integration-logging/" />
<meta property="article:published_time" content="2019-12-17T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-12-17T00:00:00+00:00" />
<meta itemprop="name" content="Creating a custom logger">
<meta itemprop="description" content="MinnoJS automatically sends data from questionnaires (miQuest) and about tasks (which task was visited). It also sends data from reaction-time tasks (those programmed in miTime), about all the trials that triggered the ‘log’ action. But there is more. You can create custom loggers for integration with other systems. In this post we will create a logger that takes data from a minno-time task and saves it as a JSON string into an input element.">
<meta itemprop="datePublished" content="2019-12-17T00:00:00+00:00" />
<meta itemprop="dateModified" content="2019-12-17T00:00:00+00:00" />
<meta itemprop="wordCount" content="644">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Creating a custom logger"/>
<meta name="twitter:description" content="MinnoJS automatically sends data from questionnaires (miQuest) and about tasks (which task was visited). It also sends data from reaction-time tasks (those programmed in miTime), about all the trials that triggered the ‘log’ action. But there is more. You can create custom loggers for integration with other systems. In this post we will create a logger that takes data from a minno-time task and saves it as a JSON string into an input element."/>







<link rel="preload" href="/scss/main.min.2b3f0c56cf34795796f776325f0851d09b271972227cc6cb952d02ee2a9955bd.css" as="style">
<link href="/scss/main.min.2b3f0c56cf34795796f776325f0851d09b271972227cc6cb952d02ee2a9955bd.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>




  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold"></span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link" href="/en/about/" ><span>About</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link" href="/en/docs/" ><span>Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link active" href="/en/blog/" ><span class="active">Blog</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
</div>
</nav>

    </header>
    <div class="container-fluid td-default td-outer">
      <main role="main" class="td-main">
        

<p>MinnoJS automatically sends data from questionnaires (miQuest) and about tasks (which task was visited).
It also sends data from reaction-time tasks (those programmed in miTime), about all the trials that triggered the <a href="https://minnojs.github.io/minno-time/0.3/time/API.html#interactions-actions">‘log’ action</a>.
But there is more. You can create custom loggers for integration with other systems.
In this post we will create a logger that takes data from a minno-time task and saves it as a JSON string into an input element.</p>
<p>In this post, we will create a logger that instead of sending the data to the server, will save it in an html <code>&amp;lt;input&amp;gt;</code> element.
This is usefull because many times it is easyes to submit the outcome of your study within a simple form provided by a third party.
For example, <a href="https://www.qualtricfs.com/">Qualtrics</a>, a popular survery service provides an easy way to create forms (including <code>&amp;lt;input&amp;gt;</code> elements),
but does not provide time sensitive tasks.
If you want to add a MinnoJS task to Qualtrics you could save the data into Qualtrics by injecting it into an existing <code>&amp;lt;input&amp;gt;</code> element.</p>
<p>First, we need to understand how the logger works
(full documentation can be found <a href="https://github.com/minnojs/minno-quest/blob/0.3/src/taskManager/logger/readme.md">here</a>).</p>
<p>MinnoJS allows you to manually modify its logging behaviour by using the <code>logger</code> setting.
The logger takes a settings object with four properties: <code>onRow</code>, <code>onEnd</code>, <code>serialize</code>, and <code>send</code>.
They are all required and each refers to a different part of the logging proccess.
We will go through each one and explain how it works.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">addSettings</span>(<span style="color:#e6db74">&#39;logger&#39;</span>, {
    <span style="color:#a6e22e">onRow</span><span style="color:#f92672">:</span> ...,
    <span style="color:#a6e22e">onEnd</span><span style="color:#f92672">:</span> ...,
    <span style="color:#a6e22e">serialize</span><span style="color:#f92672">:</span> ...,
    <span style="color:#a6e22e">send</span><span style="color:#f92672">:</span> ...
});
</code></pre></div><p><strong><code>onRow</code></strong>:
Each time Minno decides to log data (e.g., at the end of a questionnaire implemented with miQuest, or after the user used the ‘log’ action in miTime),
it calls <code>onRow</code> with the data to be logged.
This is our chance to manipulate each data row and extract the specific data that we want (in this case only latency and trial score).
If the onRow function returns anything, it gets immediately serialized and sent to the server.
In our case we want to “send” the data only at the end, so what we want to do is set aside the data until we are ready to save it.
What we do is save it into the context until the end of the task.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">logName</span>, <span style="color:#a6e22e">log</span>, <span style="color:#a6e22e">settings</span>, <span style="color:#a6e22e">ctx</span>){
    <span style="color:#75715e">// ctx is an object that is constant across calls to the logger
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// we keep a logs array in ctx to collect al the logs until the end of the trial
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">logs</span>) <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">logs</span> <span style="color:#f92672">=</span> [];
    <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">logs</span>.<span style="color:#a6e22e">push</span>({<span style="color:#a6e22e">latency</span><span style="color:#f92672">:</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">latency</span>, <span style="color:#a6e22e">score</span><span style="color:#f92672">:</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">score</span>});
}
</code></pre></div><p><strong><code>onEnd</code></strong>: This function gets called once at the end of the task.
It is our chance to wrap up logging and do something with the logs that we saved into the context.
We tell the logger to send the logs simply by returning them
(sending is usually to the server, in our case it will be to the <code>&amp;lt;input&amp;gt;</code> ):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">settings</span>, <span style="color:#a6e22e">ctx</span>){
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">logs</span>;
}
</code></pre></div><p><strong><code>serialize</code></strong>: This function allows you to transform the log objects that are returned by <code>onRow</code> and <code>onEnd</code>.
In this case we simply transform them into <a href="https://en.wikipedia.org/wiki/JSON">JSON</a> strings.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">logs</span>, <span style="color:#a6e22e">settings</span>){
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">logs</span>);
}
</code></pre></div><p><strong><code>send</code></strong>: This function performs the actual sending of the serialized data.
In our case all we want to do is set the results in a text input.
If you are integrating with a server, this is where you would put the code to update it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">serialized</span>, <span style="color:#a6e22e">settings</span>, <span style="color:#a6e22e">ctx</span>){
    document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;el&#39;</span>).<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">serialized</span>;
}
</code></pre></div><p>Following is the ful code for updating the logger.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">addSettings</span>(<span style="color:#e6db74">&#39;logger&#39;</span>, {
    <span style="color:#75715e">// gather logs in array
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">onRow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">logName</span>, <span style="color:#a6e22e">log</span>, <span style="color:#a6e22e">settings</span>, <span style="color:#a6e22e">ctx</span>){
        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">logs</span>) <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">logs</span> <span style="color:#f92672">=</span> [];
        <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">logs</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">log</span>);
    },
    <span style="color:#75715e">// onEnd trigger save (by returning a value)
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">onEnd</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">settings</span>, <span style="color:#a6e22e">ctx</span>){
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">logs</span>;
    },
    <span style="color:#75715e">// Transform logs into a string
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">serialize</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">logs</span>, <span style="color:#a6e22e">settings</span>){
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">logs</span>);
    },
    <span style="color:#75715e">// Set logs into an input
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">send</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">serialized</span>, <span style="color:#a6e22e">settings</span>, <span style="color:#a6e22e">ctx</span>){
        document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;el&#39;</span>).<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">serialized</span>;
    }
});
</code></pre></div>


      </main>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        
        
	
		<p class="mt-2"><a href="/en/about/">About MinnoJS</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>











<script src="/js/main.min.b201a3c9217360dbc0727dd320ea5f0bfc3f9128a4baa02246fb92034f9442a3.js" integrity="sha256-sgGjySFzYNvAcn3TIOpfC/w/kSikuqAiRvuSA0&#43;UQqM=" crossorigin="anonymous"></script>




  </body>
</html>